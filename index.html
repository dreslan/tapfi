<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TapFI - Financial Independence Tracker</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <svg width="40" height="40" viewBox="0 0 40 40" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <!-- Beer Tap -->
                    <rect x="16" y="2" width="8" height="4" fill="#94a3b8" rx="1"/>
                    <rect x="15" y="6" width="10" height="3" fill="#cbd5e1" rx="1"/>
                    <path d="M 17 9 L 17 18 Q 17 20 19 20 L 21 20 Q 23 20 23 18 L 23 9 Z" fill="#e5e7eb"/>
                    <!-- Beer Mug -->
                    <path d="M 10 22 L 10 34 Q 10 36 12 36 L 28 36 Q 30 36 30 34 L 30 22 Z" fill="#fbbf24" stroke="#f59e0b" stroke-width="1"/>
                    <rect x="10" y="20" width="20" height="3" fill="#fef3c7" rx="1"/>
                    <ellipse cx="20" cy="21" rx="9" ry="2" fill="#fff7ed" opacity="0.6"/>
                    <!-- Handle -->
                    <path d="M 30 24 Q 34 24 34 28 Q 34 32 30 32" fill="none" stroke="#f59e0b" stroke-width="2"/>
                    <!-- Coins -->
                    <circle cx="20" cy="14" r="2.5" fill="#fbbf24" stroke="#f59e0b" stroke-width="0.5"/>
                    <circle cx="20" cy="14" r="1.5" fill="#fef3c7"/>
                    <circle cx="15" cy="16" r="2" fill="#fbbf24" stroke="#f59e0b" stroke-width="0.5"/>
                    <circle cx="15" cy="16" r="1.2" fill="#fef3c7"/>
                    <circle cx="25" cy="16" r="2" fill="#fbbf24" stroke="#f59e0b" stroke-width="0.5"/>
                    <circle cx="25" cy="16" r="1.2" fill="#fef3c7"/>
                </svg>
                TapFI
            </h1>
            <p class="subtitle">Tap Into your Financial Independence</p>
            <div class="card-controls">
                <button id="expandAll" class="btn btn-secondary btn-sm">Expand All</button>
                <button id="collapseAll" class="btn btn-secondary btn-sm">Collapse All</button>
            </div>
        </header>

        <div id="cards-container">
        <!-- FI Target Configuration -->
        <section class="fi-config card collapsible" data-card-id="fi-config" draggable="true">
            <div class="card-header">
                <span class="drag-handle">⋮⋮</span>
                <h2>Financial Independence Goal</h2>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="card-content">
                <div class="config-grid">
                    <div class="input-group">
                        <label for="annualExpenses">Annual Expenses ($)</label>
                        <input type="text" id="annualExpenses" placeholder="40,000" data-type="currency">
                    </div>
                    <div class="input-group">
                        <label for="withdrawalRate">Withdrawal Rate (%)</label>
                        <input type="number" id="withdrawalRate" placeholder="4" min="0" max="10" step="0.1" value="4">
                    </div>
                    <div class="input-group">
                        <label for="fiTarget">Target Amount ($)</label>
                        <input type="text" id="fiTarget" placeholder="1,000,000" data-type="currency">
                    </div>
                    <div class="input-group">
                        <label for="penaltyFreeAge">Penalty-Free Withdrawal Age</label>
                        <input type="number" id="penaltyFreeAge" placeholder="59.5" min="0" max="100" step="0.5" value="59.5" title="Default age for retirement account accessibility (59.5 in US, may vary by country)">
                        <small style="color: var(--text-muted); font-size: 0.75rem;">Age when retirement accounts (401k, IRA) are accessible penalty-free</small>
                    </div>
                    <button id="saveConfig" class="btn btn-primary">Save Goal</button>
                </div>
            </div>
        </section>

        <!-- Future Projections -->
        <section class="projections card collapsible" data-card-id="projections" draggable="true">
            <div class="card-header">
                <span class="drag-handle">⋮⋮</span>
                <h2>Future Projections</h2>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="card-content">
                <div class="config-grid">
                    <div class="input-group">
                        <label for="monthlyContribution">Monthly Contribution ($)</label>
                        <input type="text" id="monthlyContribution" placeholder="2,000" data-type="currency">
                        <small style="color: var(--text-muted); font-size: 0.75rem;">Assumed to go to accessible accounts</small>
                    </div>
                    <div class="input-group">
                        <label for="annualReturn">Expected Return (%)</label>
                        <input type="number" id="annualReturn" placeholder="7" min="0" max="20" step="0.1" value="7">
                    </div>
                    <div class="input-group">
                        <label for="currentAge">Current Age</label>
                        <input type="number" id="currentAge" placeholder="30" min="0" max="100" step="1" value="30">
                    </div>
                    <div class="input-group">
                        <label for="retirementAge">Retirement Age</label>
                        <input type="number" id="retirementAge" placeholder="65" min="0" max="100" step="1" value="65">
                    </div>
                    <div class="input-group">
                        <label for="projectionYears">Years to Project</label>
                        <input type="number" id="projectionYears" placeholder="Auto" min="1" max="100" step="1">
                        <small style="color: var(--text-muted); font-size: 0.75rem;">Leave empty to auto-calculate</small>
                    </div>
                </div>

                <div class="chart-container" style="height: 400px; position: relative;">
                    <canvas id="projectionChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Dashboard Overview -->
        <section class="dashboard card collapsible" data-card-id="dashboard" draggable="true">
            <div class="card-header">
                <span class="drag-handle">⋮⋮</span>
                <h2>Portfolio Overview</h2>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Net Worth</div>
                        <div class="stat-value" id="totalNetWorth">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">FI Progress</div>
                        <div class="stat-value" id="fiProgress">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Annual Income @ <span id="withdrawalRateDisplay">4</span>%</div>
                        <div class="stat-value" id="annualIncome">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Remaining to Goal</div>
                        <div class="stat-value" id="remainingAmount">$0</div>
                    </div>
                </div>
                
                <!-- View Toggle -->
                <div style="display: flex; justify-content: center; margin: 2rem 0 1rem 0; gap: 10px;">
                    <button id="viewByAccounts" class="btn btn-secondary btn-sm view-toggle active">By Accounts</button>
                    <button id="viewByHoldings" class="btn btn-secondary btn-sm view-toggle">By Holdings</button>
                </div>

                <!-- Accounts View -->
                <div id="accountsView" class="allocation-view">
                    <div class="chart-container">
                        <canvas id="allocationChart"></canvas>
                    </div>
                </div>

                <!-- Holdings View -->
                <div id="holdingsView" class="allocation-view" style="display: none;">
                    <div class="stats-grid" style="margin-bottom: 1.5rem;">
                        <div class="stat-card">
                            <div class="stat-label">Total Holdings</div>
                            <div class="stat-value" id="totalHoldingsCount">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Top Holding</div>
                            <div class="stat-value" id="topHolding" style="font-size: 1.2rem;">-</div>
                            <div class="stat-subtext" id="topHoldingValue">$0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Asset Classes</div>
                            <div class="stat-value" id="assetClassCount">0</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="holdingsAllocationChart"></canvas>
                    </div>
                </div>
                <div class="chart-container" style="margin-top: 2rem; height: 300px; position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Net Worth History</h3>
                        <button id="manageHistoryBtn" class="btn btn-secondary btn-sm">Manage Data</button>
                    </div>
                    <canvas id="historyChart"></canvas>
                </div>
            </div>
        </section>

        <!-- History Modal -->
        <div id="historyModal" class="modal">
            <div class="modal-content card">
                <div class="modal-header">
                    <h2>History Data</h2>
                    <span class="close-modal">&times;</span>
                </div>
                
                <div class="form-grid" style="margin-bottom: 20px;">
                    <div class="input-group">
                        <label for="historyDate">Date</label>
                        <input type="date" id="historyDate">
                    </div>
                    <div class="input-group">
                        <label for="historyAmount">Net Worth ($)</label>
                        <input type="text" id="historyAmount" data-type="currency" placeholder="0.00">
                    </div>
                    <button id="addHistoryEntry" class="btn btn-primary" style="align-self: end;">Add Entry</button>
                </div>

                <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                    <table class="accounts-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Net Worth</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Holdings Overview -->
        <section class="holdings card collapsible" data-card-id="holdings" draggable="true">
            <div class="card-header">
                <span class="drag-handle">⋮⋮</span>
                <h2>Holdings</h2>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="card-content">
                <div class="table-container">
                    <table id="holdingsTable">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Description</th>
                                <th>Asset Class</th>
                                <th>Value</th>
                                <th>% of Portfolio</th>
                            </tr>
                        </thead>
                        <tbody id="holdingsList">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Freedom Metrics -->
        <section class="freedom card collapsible" data-card-id="freedom" draggable="true">
            <div class="card-header">
                <span class="drag-handle">⋮⋮</span>
                <h2>Freedom Milestones</h2>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Coast FI @ Age <span id="coastTargetAge">65</span></div>
                        <div class="stat-value" id="coastFiAmount">$0</div>
                        <div class="stat-subtext">If you stop saving today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">FI Days Funded</div>
                        <div class="stat-value" id="fiDays">0</div>
                        <div class="stat-subtext">Days of freedom per year</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label" title="When your accessible funds (brokerage, crypto, savings) reach your FI target">Projected FI Date ℹ️</div>
                        <div class="stat-value" id="projectedFiDate">-</div>
                        <div class="stat-subtext" style="font-size: 0.7rem; margin-top: 0.25rem;">Based on accessible accounts only</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Financial Runway</div>
                        <div class="stat-value" id="financialRunway">0 Years</div>
                        <div class="stat-subtext">If you stopped working today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Passive Wage</div>
                        <div class="stat-value" id="passiveWage">$0.00/hr</div>
                        <div class="stat-subtext">Earnings while you sleep</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Barista FI Gap</div>
                        <div class="stat-value" id="baristaGap">$0</div>
                        <div class="stat-subtext">Monthly income still needed</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Account Management -->
        <section class="accounts card collapsible" data-card-id="accounts" draggable="true">
            <div class="card-header">
                <span class="drag-handle">⋮⋮</span>
                <h2>Accounts</h2>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="card-content">
                <!-- Add Account Forms -->
                <div class="account-forms">
                    <!-- Manual Account Entry -->
                    <div class="form-section">
                        <h3>Add Manual Account</h3>
                        <div class="form-grid">
                            <div class="input-group">
                                <label for="accountName">Account Name</label>
                                <input type="text" id="accountName" placeholder="e.g., Schwab Brokerage">
                            </div>
                            <div class="input-group">
                                <label for="accountType">Account Type</label>
                                <select id="accountType">
                                    <option value="brokerage">Brokerage</option>
                                    <option value="401k">401(k)</option>
                                    <option value="ira">IRA</option>
                                    <option value="roth">Roth IRA</option>
                                    <option value="savings">Savings</option>
                                    <option value="crypto">Cryptocurrency</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="accountBalance">Balance ($)</label>
                                <input type="text" id="accountBalance" placeholder="0.00" data-type="currency">
                            </div>
                            <div class="input-group">
                                <label for="accountWithdrawalAge">Withdrawal Age</label>
                                <input type="number" id="accountWithdrawalAge" placeholder="Auto" min="0" max="100" step="0.5" title="Age when you can access this account penalty-free (leave empty for auto-detect based on account type)">
                                <small style="color: var(--text-muted); font-size: 0.75rem;">Leave empty for auto-detect (Brokerage/Crypto=Now, 401k/IRA=Penalty-free age)</small>
                            </div>
                            <button id="addManualAccount" class="btn btn-primary">Add Account</button>
                        </div>
                    </div>

                    <!-- Bitcoin Entry -->
                    <div class="form-section">
                        <h3>Add Bitcoin Holdings</h3>
                        <div class="form-grid">
                            <div class="input-group">
                                <label for="btcAmount">Bitcoin Amount</label>
                                <input type="number" id="btcAmount" placeholder="0.5" min="0" step="0.00000001">
                            </div>
                            <div class="input-group">
                                <label for="btcPrice">Current BTC Price ($)</label>
                                <input type="number" id="btcPrice" placeholder="40000" min="0" step="0.01">
                            </div>
                            <button id="addBitcoin" class="btn btn-primary">Add Bitcoin</button>
                        </div>
                    </div>

                    <!-- CSV Import -->
                    <div class="form-section">
                        <h3>Import from CSV</h3>
                        <p class="help-text">
                            <strong>Supported formats:</strong> Schwab and Fidelity account statements.<br>
                            <strong>Schwab:</strong> Export "Positions" from your account dashboard.<br>
                            <strong>Fidelity:</strong> Download "Positions" CSV from Portfolio tab.
                        </p>
                        <div class="file-input-wrapper">
                            <input type="file" id="csvFileInput" accept=".csv" class="file-input">
                            <label for="csvFileInput" class="btn btn-secondary">Choose CSV File</label>
                            <span id="fileName" class="file-name">No file chosen</span>
                        </div>
                        <button id="importCsv" class="btn btn-primary" disabled>Import CSV</button>
                    </div>
                </div>

                <!-- Accounts Table -->
                <div class="accounts-table-wrapper">
                    <h3>Current Accounts</h3>
                    <table id="accountsTable" class="accounts-table">
                        <thead>
                            <tr>
                                <th>Account Name</th>
                                <th>Type</th>
                                <th>Balance</th>
                                <th title="Age when account funds become accessible penalty-free">Withdrawal Age ℹ️</th>
                                <th>% of Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="accountsTableBody">
                            <tr class="empty-state">
                                <td colspan="6">No accounts added yet. Add your first account above!</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Data Management -->
        <section class="data-management card collapsible" data-card-id="data-management" draggable="true">
            <div class="card-header">
                <span class="drag-handle">⋮⋮</span>
                <h2>Data Management</h2>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="card-content">
                <div class="button-group">
                    <button id="exportData" class="btn btn-secondary">Export All Data (JSON)</button>
                    <button id="importData" class="btn btn-secondary">Import Data (JSON)</button>
                    <button id="clearData" class="btn btn-danger">Clear All Data</button>
                </div>
                <input type="file" id="jsonFileInput" accept=".json" style="display: none;">
            </div>
        </section>
        </div>

        <footer>
            <p>All data is stored locally in your browser. No data is sent to external servers.</p>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>
